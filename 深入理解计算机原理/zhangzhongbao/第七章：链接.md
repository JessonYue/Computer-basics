链接(linking)是将各种代码和数据片段收集并组合成为一个单一文件的过程，这个文
件可被加载（复制）到内存并执行。
- 链接可以执行于编译时 (compile time)也就是在源代码被翻译成机器代码时。
- 也可以执行于加栽时（loadtime)也就是在程序被加载器（loader)加载到内存并执行时
- 甚至执行于运行时（runtime)，也就是由应用程序来执行
- 
### 7.2 静态链接
链接器必须完成两个主要任务：
- 符号解析(symbol resolution)  
目标文件定义和引用符号，每个符号对应于一个函数、一个全局变量或一个静 态变量（即 C 语言中任何以 static 属性声明的变量）。符号解析的目的是将每个符号引用正好和一个符号定义关联起来
- 重定位（relocation)  
链接器通过把每个符号定义与一个内存位置关联起来，从而重定位这些节，然后修改所有对这些符号的引用，使得它们指向这个内存位置。
### 7.3 目标文件
- 可重定位目标文件。
- 可执行目标文件
- 共享目标文件。一种特殊类型的可重定位目标文件，可以在加载或者运行时被动态
地加载进内存并链接
### 7.4可重定位目标文件
![可重定位目标文件.png](images\可重定位目标文件.png)
- .text: 已编译程序的机器代码
- .todat_a: 只读数据
- .data: 已初始化的全局和静态 C 变量
- .bss: 未初始化的全局和静态 C 变量，以及所有被初始化为 0 的全局或静态变量
- .symtab: —个符号表，它存放在程序中定义和引用的函数和全局变量的信息
- .rel.text: —个.text 节中位置的列表，当链接器把这个目标文件和其他文件组合
时，需要修改这些位置。
- .rel.data: 被模块引用或定义的所有全局变量的重定位信息。
- .strtab: —个字符串表 

需要加-g编译选项
- .debug: 个调试符号表
- line: 原始 C 源程序中的行号和.text 节中机器指令之间的映射

### 7.6 符号解析
静态局部变量也会有本地链接器符号，编译器还要确保它们拥有唯一的名字。（神奇的静态局部变量）

#### 7.6.1 链接器如何解析多重定义的全局符号
根据强弱符号的定义，Linux 链接器使用下面的规则来处理多重定义的符号名
* 规则 1: 不允许有多个同名的强符号。
* 规则 2: 如果有一个强符号和多个弱符号同名，那么选择强符号。
* 规则 3: 如果有多个弱符号同名，那么从这些弱符号中任意选择一个。

 #### 7.6.2 与静态库链接
 所有的编译系统都提供一种机制，将所有相关的目标模块打包成为一个单独的文件，称为 静态库（static library）  

 链接时只复制被引用的部分函数

 静态库以一种称为存档（archive)的特殊文件格式存放在磁盘中。存
档文件是一组连接起来的可重定位目标文件的集合，有一个头部用来描述每个成员目标文件的大小和位置。存档文件名由后缀.a 标识



