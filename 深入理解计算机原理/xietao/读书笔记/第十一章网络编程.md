# 网络编程

网络应用依赖于很多在系统研究中已经学习过的概念。例如，进程、信号、字节顺 序、内存映射以及动态内存分配，都扮演着重要的角色。

## 客户端-服务端模型

每个网络应用都是基于客户端-服务器模型的。采用这个模型，一个应用是由一个服 务器进程和一个或者多个客户端进程组成。服务器管理某种资源，并且通过操作这种资源 来为它的客户端提供某种服务。

一个客户端-服务 器事务由以下四步组成：

1、当一个客户端需要服务时，它向服务器发送一个请求，发起一个事务。

2、服务器收到请求后，解释它，并以适当的方式操作它的资源。

3、服务器给客户端发送一个响应 ，并等待下一个请求。

4、客户端收到响应并处理它。

## 网络

网络是连接客户端与服务器之间的通路，对于主机而言，网络只是插在IO总线上的一种，从网络上接收的数据经过适配器-IO总线-桥-存储器总线-主存。

在网络建立的初期，是通过一个集线器，实现无差别的所有主机之间的数据交换。同交换机不同，集线器不是点到点，它的每次转发都是针对所有的主机，这就形成了一个局域网。

## 全球IP因特网

### 1、Ip地址

一个 IP 地址就是一个 32 位无符号整数。在 IP 地址结构中存放的地址总是以(大端法)网络字节顺序存放的，即使主机字节顺序(host byte order)是小端法。IP 地址通常是以一种称为点分十 进制表示法来表示的，每个字节由它的十进 制值表示，并且用句点和其他字节间分开

### 2、域名

域名集合形成了一个层次结构分为：

第一层域名是一个非营利性组织定义的，常见的有.com、edu、gov等

第二层cmu.edu是按照先后顺序获得的，一旦获得了cmu，就可以向下生成cs\ece等

### 3、因特网链接

通常使用的是一个套接字完成一个客服端与服务端之间的双向连接的每个端是由该端的地址：端口组成，其中服务端的端口通常是固定的，而客服端的端口是临时分配的，当形成了一个套接字对的时候，就可以开始双向通信了。

## 套接字接口

套接字接口(socketinterface)是一组函数，它们和 Unix I/O函数结合起来，用以创建 网络应用。

#### 1、 socket函数：

socket函数创建一个套接字描述符，使用clientfd = socket（AF_INET, SOCK_STREAM, 0）；来描述，其中AF_INET表示使用互联网，SOCK_STREAM表示使用套接字连接的一个端点。

#### 2、connect函数

connect函数：客服端建立同服务器的连接

#### 3、bind函数

bind函数告诉内核将 addr中的服务器套接字地址和套接字描述符 sockfd联系起来。

#### 4、listen函数

listen函数将 sockfd从一个主动套接字转化为一个监听套接字(listening socket)， 该套接字可以接受来自客户端的连接请求。

#### 5、accept函数

等待客户端的连接，创建已连接描述符。监听描述符创建一次存在于整个生命周期，已连接描述符只存在于一个客户端，可以创建并发服务器。

第一步：服务器调用accept，等待连接到达监听描述符；

第二步：客户端调用connect函数，发送一个连接请求到监听描述符；

第三步：打开一个已连接描述符connfd（4）通过connfd和clientfd交换数据。

## Web 服务器

Web客户端（浏览器）与服务器之间的交互是基于一个HTTP协议，同常规的FTP协议不同，传输的是超文本标记语言（HTML）。

#### 1、web基础

Web客户端（浏览器）与服务器之间的交互是基于一个HTTP协议，同常规的FTP协议不同，传输的是超文本标记语言（HTML）

#### 2、Web服务器发送的内容

web发送的内容是一个MIME类型的序列。

Web 服务器以两种不同的方式向客户端提供内容：

1、取一个磁盘文件，并将它的内容返回给客户端。

2、运行一个可执行文件，并将它的输出返回给客户端。

#### 3、HTTP事务

1、 请求

我们使用telnet 对www.aol.com 80端口进行连接，然后输入我们的请求：由两部分组成

请求行：GET / HTTP/1.1要求获取/index.html文件的内容;

请求头：host:www.aol.com附加额外信息；

最后我们以一个换行符号将我们的请求发送给服务器。

2、响应

响应由三部分组成，响应行：HTTP/1.1 301 Moved Permanently 、多个响应头和响应主体构成。

### 4、服务动态内容

1、客户端如何将程序参数传递给服务器。

2、服务器如何将参数传递给子进程。

3、服务器如何将其他信息传递给子进程。

4、子进程将它的输出发送到哪里。





