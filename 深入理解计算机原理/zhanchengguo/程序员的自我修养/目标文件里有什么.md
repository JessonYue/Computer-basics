#### 目标文件里有什么

- 3.1、目标文件的格式
  - 可执行文件的格式主要是Windows下的PE和Linux的ELF，都是COFF格式的变种
  - 动态链接库（.dll、.so）和静态链接库（.lib、.a）文件都是按照可执行文件格式存储
  - ELF文件包含的四类：
    1. 可重定位文件（.o）
    2. 可执行文件
    3. 共享目标文件（.so）
    4. 核心转储文件
- 3.2、目标文件是什么样的
  - 一般目标文件将信息按不同的属性，以“节”（Section）的形式存储，有时候也叫“段”（Segment），在一般情况下，它们都表示一个一定长度的区域，基本不加以区别，唯一的区别是在ELF的链接视图和装载视图的时候
  - 程序源代码编译后的机器指令放在代码段（.code、.text）;全局变量和局部静态变量数据放在数据段（.data、.bss）
  - ELF文件的开头是一个“文件头”，描述整个文件的文件属性，包括文件是否可执行、是静态链接还是动态链接及入口地址、目标硬件、目标操作系统等，文件头还包括一个段表，其实是一个描述文件中各个段的数组
  - 编译后的机器代码保存在.text段；已初始化的全局变量和局部静态变量保存在.data段；未初始化的全局变量和局部静态变量保存在.bss段
  - 程序源代码被编译以后主要分为两种段：程序指令和程序数据。代码段属于程序指令，而数据段和.bss段属于程序数据
- 3.3、挖掘.o（目标文件）
  - .text段、.data段、.bss段
  - “.rodata”只读数据段，存放的是只读数据，一般是程序里面的只读变量（如const修饰的变量）和字符串常量
  - .debug段：调试信息
  - .dynamic段：动态链接信息
  - .hash段：符号哈希表
  - .strtab段：字符串表
  - .symtab段：符号表
  - .plt、.got段：动态链接的跳转表和全局入口表
- 3.4、ELF文件结构描述
  - 文件头：定义了 ELF 魔数、文件机器字节长度、 数据存储方式、版本、运行平台、ABI 版本、ELF 重定位类型、硬件平台、硬件平台版本、 入口地址、程序头入口和长度、段表的位置和长度及段的数量
  - 段表（Section Header Table）：保存这些段的基本属性的结构。描述ELF各个段的信息，比如段名、段长、在文件中的偏移、读写权限等
  - 重定位表（Relocation Table）：链接器在处理目标文件时，需要对目标文件中的某些部位进行重定位，即代码段和数据段中那些绝对地址的引用的位置。（.rel.text段、.rel.data段）
  - 字符串表（String Table）：用来保存普通的字符串，如符号的名字。（.strtab段、.shstrtab段）
- 3.5、链接的接口-符号
  - 链接的本地就是把多个不同的目标文件之间相互“粘”到一起，或者说像玩具积木那样，可以拼装形成一个整体
  - 在链接中，将**函数和变量统称为符号**，函数名或者变量名就是符号名
  - 每一个目标文件都会有一个相应的符号表（Symbol Table），这个表里面记录了目标文件中所用到的所有符号。每个定义的符号有一个对应的值，叫做**符号值**，对于变量和函数来说，符号值就是**它们的地址**
  - 符号表中的符号分类：
    1. 定义在本目标文件的全局符号
    2. 在本目标文件中引用的全局符号，却没有定义在本目标文件中（外部符号）
    3. 段名
    4. 局部符号
    5. 行号信息
  - 符号表（Symbol Table）:记录了目标文件中所用到的所有符号（.symtab段）
  - 特殊符号
  - 不同的链接库使用，会出现**名称冲突**
  - 符号修饰和函数签名：为了解决函数重载，或者不同的名称空间下多个同样名字的符号，可以认为它们是不同的函数，使用**函数签名**来识别不同的函数，，每个函数签名对应一个修饰后的名称
  - 编辑器在将C++源代码编译成目标文件时，会将函数和变量的名称进行修饰，形成符号，也就是说，C++源代码编译后的目标文件所使用的符号名是相应的函数和变量修饰后的名称
  - extern "C"：C++用来声明或定义一个C的符号，C++编译器会将extern "C"的大括号内部的代码当作 C 语言代码处理
  - 符号重复定义：多个目标文件含有相同名字全局符号的定义
  - 编译器默认函数和初始化了的全局变量为**强符号**，未初始化的全局变量为**弱符号**，可以通过“ attribUte ((weak))”来定义任何一个强符号为弱符号
  - 链接器按如下规则处理与选择多次定义的全局符号（强弱符号）：
    		1. 不允许强符号被多次定义
      		2. 如果一个符号在某个目标文件中是强符号，在其他文件中都是弱符号，那么选强符号
      		3. 如果一个符号在所有的目标文件中都是弱符号，那么选择其中占用空间最大的一个



