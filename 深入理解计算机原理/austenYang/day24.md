### 12.7 其他并发问题

#### 1. 线程安全

四个线程不安全函数分类：

* 不保护共享变量的函数
* 保持跨越多个调用状态的函数
* 返回值指向静态变量的函数
* 调用线程不安全函数的函数

#### 2. 可重入性

![image-20200625110951643](https://note-austen-1256667106.cos.ap-beijing.myqcloud.com/2020-06-25-030955.png)

**可重入函数（reentrant function）** 是线程安全函数的一类，上面 的图已经很明确了。

定义：当它被多个线程调用时，不会引用任何共享数据。

可重入函数通常要比 不可重入的线程安全的函数 更高效，因为它们不需要同步操作。

可重函数分为：

1. 显示可重入：如果函数的参数都是值传递的（没有指针），并且所有数据都是引用的
2. 隐式可重入：编程中，使用指针，但这些指针指向非共享变量的指针。

> 思考：
>
> 1. 函数的可重入性，看起来很想 Kotlin 中，也就是函数式编程中，讲的 纯函数。和数学上的函数很相识，函数的行为之和函数本身有关系。
>
> * 可重入性是否就是函数式编程中讲的 纯函数？
>
> 2. 可重入性  **Reentrant**，感觉和 Java 中的 ReentrantLock 字面上一样。
>
> * 两者底层上实现是否有关系？



#### 3. 多线程环境下使用已存在的库函数

一下 C 标准下的已存在的库函数是线程不安全的，那么要在多线程环境下编程，可以使用 Linux 系统提供的它们的可重入版本。可重入的版本后边 `_r`。

![image-20200625202900780](https://note-austen-1256667106.cos.ap-beijing.myqcloud.com/2020-06-25-122913.png)

