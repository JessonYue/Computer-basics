## 内存映射

Linux通过将一个虚拟内存区域与一个磁盘上的对象关联起来，以初始化这个虚拟内存区域的内容，这个过程叫做内存映射。


**虚拟内存区域可以映射到两种类型的对象中**
- Linux文件系统中的普通文件
- 匿名文件
一旦一个虚拟页面被初始化额，他就在一个由内核维护的专门的交换文件之间换来换去，。交换文件也叫做交换空间或者交换区域

### 再看共享对象
如果每个进程都在物理内存中保持了一些常用的代码副本，则会浪费内存，通过内存映射可以解决这个问题

 一个对象可以被映射到虚拟内存的一个区域，要么作为共享对象，要么作为私有对象。
 
 每个对象都有唯一的文件名，内河可以许速递判定进程1已经映射这个对象，而且 可以使进程2中的页表条目指向相应的物理页面。
 
 写时复制
 
###  在看fork函数

当fork函数 被当前进程调用时，内核为新进程创建各种数据结构，并分配一个唯一PID，为了给这个新进程创建一个虚拟内存，创建了当前进程的mm_struct、区域结构和页表的原样副本。将两个进程的每个页面都标记为只读，并将两个进程中的每个区域结构都标记为写时复制。

### 使用mmap函数的用户级内存映射

## 动态内存分配

动态内心分配器维护一个进程的虚拟内存区域，称为堆；

分配器将堆视为一组不同大小的块的集合来维护，每个块就是一个连续的虚拟内存片，要么是已分配的，要么是空闲的。

**分配器有两种基本风格，区别在于有哪个实体来负责释放已分配的块。**
- 显示分配器 ：通过调用free释放一个块
- 隐式分配器：通过垃圾收集来释放未使用的块

### malloc和free函数

malloc函数返回一个指针，指向大小至少为size字节的内存块（类型对齐）

### 碎片
**内部碎片**



**外部碎片**

当空闲内存合计起来足够满足一个分配请求，但是没有一个单独的空闲块足够可以处理这个请求。

## 垃圾收集

垃圾收集器将内存视为一张有向可达图，不可达的节点对应于垃圾。

### Mark&Sweep垃圾收集器


## C程序中常见的与内存有关的错误

##### 间接引用坏指针
##### 读取未初始化的内存
##### 允许栈缓冲区溢出
##### 假设指针和他们指向的对象是大小相同的
##### 造成错位错误
##### 引用指针，而不是它所指向的对象
##### 误解指针运算
##### 引用不存在的变量
##### 引用空闲堆块中的数据
##### 引起内存泄漏
