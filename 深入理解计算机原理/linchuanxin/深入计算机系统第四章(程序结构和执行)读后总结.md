4.1指令体系结构

- 定义一个指令集体系结构（例如Y86-64)包括定义各种状态单元、指令集和它们的编码、一组编程规范和异常事件处理。

- y86-64有15 个程序寄存器：％rax,％rcx,％rdx,%rbx ,%rsp,%rbp,%rsi%rdi 和 %r8 到%rl4

- 内存从概念上来说就是一个很大的字节数组，保存着程序和数据,Y86-64 程序用虚拟地址来引用内存位置

- 硬件和操作系统软件联合起来将虚拟地址翻译成实际或物理地址，指明数据实际存在内存中哪个地方

  

4.1.2  y86-64指令

- Y86-64 指令集基本上是x86-64 指令集的一个子集
- 它只包括8 字节整数操作，寻址方式较少，操作也较少。因为我们只有8 字节数据，所以称之为“字(word)” 不会有任何歧义。

***

细节

1. **x86-64 的movq 指令分成了4 个不同的指令：imovqÿ rrmovqÿ mrmovq 和rmmovqÿ**
   **分别显式地指明源和目的的格式。源可以是立即数（i)、寄存器（r)或内存（m)。指令**
   **名字的第一个字母就表明了源的类型。目的可以是寄存器（r)或内存(m)ÿ 指令名字的**
   **第二个字母指明了目的的类型**
2. **有4 个整数操作指令，如图4-2 中的OPqÿ 它们是addqÿ subqÿ andq 和xorqÿ 它**
   **们只对寄存器数据进行操作，而X86-64 还允许对内存数据进行这些操作。这些指令**
   **会设置3 个条件码ZFÿ SF 和OF(零、符号和溢出）**
3. **7 个跳转指令（图4-2 中的jXX)是jmp ,jle, jl, je, jne, jge 和jg根据分支**
   **指令的类型和条件代码的设置来选择分支**
4. **有6 个条件传送指令（图4-2 中的cmovXX): cmovleÿ cmovlÿ**
   **cmovge 和cmovgÿ 这些指令的格式与寄存器-寄存器传送指令rrmovq —样，但是**
   **只有当条件码满足所需要的约束时，才会更新目的寄存器的值**
5. **call 指令将返回地址人栈，然后跳到目的地址。ret 指令从这样的调用中返回**
6. **pushq 和popq 指令实现了入栈和出栈，就像在x86-64 中一样。**
7. **halt 指令停止指令的执行。X86-64 中有一个与之相当的指令hitÿ x86-64 的应用**
   **程序不允许使用这条指令，因为它会导致整个系统暂停运行**

***

4.1.3指令编码

![](https://gitee.com/andylinchuanxin/bookimagenew/raw/master/img/4-2.png)

1. 每条指令需要1-10 个字节不等，这取决于需要哪些字段。每条指令的第一个字节表明指令的类型。这个字节分为两个部分，每部分4位：高4 位是代码（code)部分，低4 位是功能（function)部分，代码值为0~0xB

2. 15 个程序寄存器中每个都有一个相对应的范围在〇到〇xE 之间的寄存器标识符。丫86-64中的寄存器编号跟乂86-64中的相同。程序寄存器存在CPU 中的一个寄存器文件中，这个寄存器文件就是一个小的、以寄存器ID 作为地址的随机访问存储器。

   ![](https://gitee.com/andylinchuanxin/bookimagenew/raw/master/img/4-4.png)

**X86-64 有时称为“复杂指令集计算机”（CISC，读作“sisk”与“精简指令集计算机”（RISC，读作“risk” 相对。**



4.1.6   y86-64指令详情

pmshq 指令会把栈指针减8, 并且将一个寄存器值写人内存中。因此，当执行pushq%rsP 指令时，处理器的行为是不确定的，因为要人栈的寄存器会被同一条指令修改。通常有两种不同的约定：

 1)压人％rsp 的原始值，

2)压人减去8的％rsp的值。



4.2逻辑设计和硬件控制语言HCL

逻辑1 是用1.0 伏特左右的高电压表示的，而逻辑0 是用0.0 伏特左右的低电压表示的

***一个数字系统需要三个主要的组成部分：***

计算对位进行操作的函数的组合逻辑、存储位的存储器单元，以及控制存储器单元更新的时钟信号





4.3.4 SEQ 阶段的实现

![](https://gitee.com/andylinchuanxin/bookimagenew/raw/master/img/4-26.png)

- 取指阶段
- 译码和写回阶段
- 执行阶段
- 访存阶段

**SEQ的pc在哪里**

![](https://gitee.com/andylinchuanxin/bookimagenew/raw/master/img/4-39.png)

