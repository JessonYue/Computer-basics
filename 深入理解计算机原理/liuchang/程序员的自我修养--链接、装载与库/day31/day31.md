## 											系统调用与API

### 1、系统调用介绍

系统调用时应用程序（运行库也是应用程序的一部分）与操作系统内核之间的接口，它决定了应用是如何与内核打交道的，无论程序时直接进行系统调用，还是通过运行库，最终还是会到达系统调用这个层面。

#### 1、什么是系统调用

系统调用既然作为一个接口，而且是非常重要的接口，它的定义将十分重要。因为所有的应用程序都依赖于系统调用，那么，首先系统调用必须有明确的定义，即每个调用的含义、 参数 、行为都需要有严格而清晰的定义，这样应用程序(运行库)才可以正确地使用它；其次它必须保持稳定和向后兼容，如果某次系统更新导致系统调用接口发生改变，新的系统调用接口与之前版本完全不同，这是无法想象的，因为所有之前能正常运行的程序都将无法使用。所以操作系统的系统调用往往从开始定义后就基本不做改变，而仅仅是增加新的调用接口, 以保持向后兼容。

#### 2、系统调用的弊端

大部分操作系统的系统调用都有两个特点：

1、使用不便。操作系统提供的系统调用接口往往过于原始，程序员须要了解很多与操作系统相关的细节。

2、各个操作系统之间调用不兼容

在系统调用和程序之间 增加了一个抽象层来解决系统调用的不方便之处：

1、使用简便。

2、形式统一。

但是运行厍也有运行库的缺陷，比如 C 语言的运行库为了保证多个平台之间能够相互 通用，于是它只能取各个平台之间功能的交集。比如 Windows 和 Linux 都支持文件读写， 那么运行库就吋以有文件读写的功能:但是 Windows 原生支持图形和用户交互系统，而 Linux 却不是原生支持的(通过 XWindows), 那么 CRT 就只能把这部分功能省去。因此，一旦程 序用到了那些 CRT 之外的接口，程序就很难保持各个平台之间的兼容性了。

### 2、系统调用原理

#### 1、特权级与中断

现代的 CPU 常常可以在多种截然不同的特权级别执行指令，在现代操作系统中，通常也据此有两种特权级别，分别为用户模式（User Mode） 和 内核模式（Kernel Mode)。也被称为用户态和内核态。

操作系统一般通过中断来从用户态切换到内核态。

中断时一个硬件或软件发出的请求，要求 CPU 暂停当前的工作转手去做更重要的事情。

中断一般具有两个属性，一个成为中断号（从0开始），一个称为中断处理程序。不同的中断具有不同的中断号，而同时一个中断处理程序一一对应一个中断号。

在内核中，有一个素组称为中断向量表（Interrupt Vector Table），这个数组的第n项包含了指向第 n 号中断的中断处理程序的指针。



