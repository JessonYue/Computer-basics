程序的机器级表示(上) 第1部分-第5部分

GCC C语言编译以汇编代码的形式产生输出，汇编代码是机器代码的文本表示，给出程序中的每一条指令。

GCC调用汇编器和链接器，根据汇编代码生成可执行的机器代码。

高级语言编写的程序可以在多个不同机器上编译和执行，而汇编代码则是与特定机器密切相关的。

®能够阅读和理解汇编代码对于程序猿仍是一种很重要的技能。

第一部分 历史观点

Inter 处理器系列俗称 x86 ，经过了一个长期的、不断进化的发展过程。

摩尔定律：在一个固定周期内，计算机的的多个方面中，某一个方面呈现翻倍增长的的现象。此定律对业内任何公司适用。

第二部分 程序编程

编译选择 -Og 告诉编译器适用会生成符合原始 C 代码正题结构的机器代码的优化等级。使用较高级别优化产生的代码会严重变形，以至于产生的机器代码和初始源代码之间的关系难以理解。

扩充知识：GCC版本 4.8 引入了优化等级。在此之前的版本和非GUN编译器 并无法识别这个选项。但是 对于某些编译器使用优化效果会更好。

优化过程：

1、C 预处理器扩展源代码，插入 include 命令指定的文件，并扩展所有用 include 生命过的宏。

2、编译器将产生源文件的汇编代码。

3、汇编器将汇编代码转换成为二进制代码文件。

4、链接器将目标代码文件与实现库函数代码合并，并产生可执行文件。

一、机器级代码

机器级代码 两种抽象方式：

1、指令集体系结构或 指令集架构：它定义了 处理器状态、指令格式和指令对处理器状态的影响。

2、虚拟内存：看上去是一个很大的数组。

在编译过程中，编译器会将抽象的的对象转化为计算机可执行的的基本指令。

C语言提供了一种模型，可以在内存中声明和分配各种数据类型的对象，但是机器代码知识见的的将内存看作一个很大的，按字节寻址的数组。

程序内存包含：程序的可执行机器代码，操作系统需要的信息，用来管理过程调用和返回的运行时栈，以及用户分配的内存块。

关键点：一条指令只执行一个基本的操作。

不同GCC产生的代码也是不相同的。

二、代码示例

根据示例 产生一些特性：

1、常用的指令以及操作数较少的指令所需的字节数少，而那些不太常用或操作数较多的指令所需字节数较多。

2、设计指令个的方式是，从某个给定位置开始，可以将字节唯一地解码成机器指令。

3、反汇编器只是基于机器代码文件中的自己序列来确定汇编代码。

4、反汇编器使用的指令命令规则与 GCC 生成的汇编代码使用的有些细微的差别。

三、关于格式的注解

阅读难度在于 它本身不提供任何描述或是工作原理描述。

程序员使用汇编代码来访问机器的低级特性：

1、用汇编代码编写整个程序

2、利用GCC支持，直接在C程序中嵌入汇编代码

ATT 根据 AT&T命名的，是 GCC、OBJDUMP 和其他一些我们使用的工具的默认格式。

C 程序与汇编代码结合方式：

1、编写完整函数放入一个独立汇编文件，让汇编器和链接器把所有代码合并起来。

2、使用内联汇编特性。

四、数据格式

![image-20200604172731572](/Users/liuchang/Library/Application Support/typora-user-images/image-20200604172731572.png)

四、访问信息

X86-64信息模型

![image-20200604172854092](/Users/liuchang/Library/Application Support/typora-user-images/image-20200604172854092.png)

描述：指令可以对图中每个寄存器中的地位字节中存放的数据进行操作。

（1）操作数指令符

大多数指令是由一个或多个操作数组成。

操作数可以被分为三类：

1、立即数：用来表示常数值

2、寄存器：用来寄存某个寄存内容

3、内存引用：根据地址访问内存位置

![image-20200604174133722](/Users/liuchang/Library/Application Support/typora-user-images/image-20200604174133722.png)

（2）数据传输指令

将数据从一个位置复制到另一个位置的指令。

![image-20200604174252209](/Users/liuchang/Library/Application Support/typora-user-images/image-20200604174252209.png)

（3）压入与弹出栈数据

栈是一种数据结构，将数据放入栈 被称为压入，将数据从栈中删除被称为弹出，栈遵循“后进先出”原则

压入的指令为pushq ， 弹出的指令为 popq。

五、算数和逻辑操作

首先来一张操作方法的描述图

![image-20200604180641778](/Users/liuchang/Library/Application Support/typora-user-images/image-20200604180641778.png)

加载有效地址：将数据从内存读取到寄存器，而没有引用内存。