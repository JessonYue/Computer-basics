​																		虚拟内存

CPU访问内存的最自然的方式就是使用物理内存。

通过一条加载指令，它读取从物理地址某一位开始的字节，当CPU执行这条加载指令时，会生成一个有效物理地址，通过内存总线，把它传递给主存。主存取出从物理地址的字节，并将它返回给CPU，CPU会将它存放在一个寄存器里。

CPU先生成一个虚拟地址，再通过虚拟地址来访问贮存，这个虚拟地址在被送到内存之前先转换成适当的物理地址。

地址空间为一个非负整数地址的有序集合。

虚拟页面的集合都分为三个不相交的子集：

1、未分配的：VM系统还未分配（或创建）的页。未分配的块没有任何数据和他们相关联，因此也就不占有任何磁盘空间。

2、缓存的：当前已缓存在屋里内存中的已分配页。

3、未缓存的：未缓存在物理内存中的已分配页。

任何现代计算机系统必须为操作系统提供手段来控制对内存系统的访问。不应该允许一个用户进程修改它的只读代码段。而且也不应该允许它读或修改任何内核中的代码和数据结构。不应该允许它读或者写其他进程的私有内存，并且不允许它修改任何与其他进程共享的虚拟页面，除非所有的共享者都显式的允许它这么做（通过调用明确的进程间通信系统调用）。

![image-20200614235939645](/Users/liuchang/Library/Application Support/typora-user-images/image-20200614235939645.png)

一个虚拟内存系统要求硬件和内核软件之间紧密协作。

Linux 通过将一个虚拟内存区域与一个磁盘上的对象关联起来，以初始化这个虚拟内存区域的内容，这个过程称为内存映射。

虚拟内存区域可以映射到两种类型的对象：

1、Linux文件系统中的普通文件；

2、匿名文件：一个取悦也可以映射到一个匿名文件，匿名文件是由内核创建的，包含的全是二进制零。

显式分配器必须在一些相当严格的约束条件下工作：

1、处理任意请求序列：一个应用可以有任意的分配请求和释放请求序列，只要满足约束条件：每个释放请求必须对应于一个当前已分配块，这个块是由一个以前的分配请求获得的。

2、立即响应请求：分配器必须立即响应分配请求。

3、只使用堆：为了使分配器是可以扩展的，分配器使用的任何非标量数据结构的必须保存在堆里。

4、对齐块（对齐要求）：分配器必须对齐块，使得它们可以保存任何类型的数据对象。

5、不修改已分配的块：分配器只能操作或者改变空闲块。









