### 第八章异常控制流

> 异常控制流(ECF Exceptional Control Flow)发生在计算系统的各个层次（==硬件层和软件层==），是计算机系统中提供并发的基本机制。

#### 控制流

> a~k~是相应指令I~k~的地址。a~k~到a~k+1~的过渡叫控制转移
>
> a~0~，a~1~，a~2~，a~3~....a~n~这样的序列叫控制流

- 程序计数器（PC）中存储的值a~k~（下一条指令I~k~的地址）的改变
  - I~k~和I~k+1~在内存是相邻的  称为平滑流
  - I~k~和I~k+1~在内存不是相邻的  称为平滑流的突变
    - 跳转、调用、返回

#### 异常

> 控制流中的突变，用来响应处理器状态中的某些变化 。
>
> 在处理器中状态被编码为不同的位和信号。状态变化称为事件。

##### 异常处理

- 异常号 为非负整数  
  - 处理器的设计者分配的
    - 被零除、缺页、内存访问违例、断点、算术运算溢出
  - 操作系统内核（操作系统常驻内存的部分）的设计者分配的
    - 系统调用、来自外部的 I/O 设备的信号

##### 硬件层

###### 异常分类

- 中断
  - 外部 I/O 设备设置了处理器的中断管脚时，中断会异步地发生。
- 故障  同步发生
  - 控制返回到故障指令后面的那条指令。
  - 故障处理程序会重新启动故障指令（==？==）
- 终止  同步发生
  - 从不将控制返回给被中断的流
- 陷阱
  - 应用程序进行系统调用的入口，换句话来说就应用程序调用系统服务的入口。（应用程序到系统代码的受控入口点）
    - 例如 向磁盘读写数据，从网络读取数据，创建一个新进程，终止当前进程都是应用程序通过调用系统服务来完成的。

##### 操作系统层

> 内核用 ECF提供进程的的基本概念
>
> 在操作系统和应用程序之间的接口处（==接口处是什么？==）应用程序可以创建子进程，等待它们的子进程停止或终止，运行新的程序，以及捕获来自其他进程的信号。
>
> ECF 是实现并发的基本机制。

进程提供给应用两个重要的抽象

- 逻辑控制流
  - 提供给每个程序一个假象，好像它是独自的使用处理器
- 私有地址空间
  - 提供给每个程序一个假象，好像它是独占主存

