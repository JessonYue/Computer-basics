### 深入计算机系统第四章读后知识点总结

##### 4.1  介绍了Y86-64指令体系

###### 1.Y86指令编码长度：1~10，其中所有数值都用十六进制表示

###### 2.Y86指令是x86指令的子集



##### 4.2 逻辑门和HCL

###### 1.N个逻辑门（与或非）组和在一起，就能构建计算快，称为组合电路

###### 2.寄存器根据时钟信号来工作的：时钟到达上升沿时，寄存器才会把输入信号转化为输出信号。



##### 4.3 Y86-64的顺序实现

###### 1.Y86的顺序实现分为6个阶段，分别为：取指(从内存读取指令字节)，译码(从寄存器文件读取最多两个操作数)，执行(根据取指的指令来完成响应的工作，计算出我们需要的值valE)，访存(从内存读/写数据)，写回(把结果写入寄存器)，更新PC(将PC设置成吓一条指令的地址。)



##### 4.4流水线

###### 流水线工作能增加指令的吞吐量，但是也有一些缺点：

######     1.不一致的划分。指令分为6个阶段，每条指令在每个阶段的运行速率不一样，如果统一流水线的每个阶段的时间，会导致资源的浪费，可能某个指令在某个阶段没有工作，这就导致指令的延迟。

######     2.流水线过深，收益下降。如果把流水线的阶段增加，响应的流水线寄存器也会增加，这时寄存器的延迟成了吞吐量的一个绊脚石。



##### 4.5 Y86-64的流水线实现

###### Y86-64的流水线对通用的流水线做了优化：把阶段6(PC更新阶段)在一个时钟周期开始时执行，通用的是在结束时执行，好比把do...while变成了while。

###### 这个优化最初的尝试是在各个阶段之间插入流水线寄存器来实现的。

###### 一般穿过流水线的对象都是相互独立的，但是像X86和Y86这样的系统，相邻指令之间很可能是相关的，当相邻指令之间存在相关时，就可能会出现问题。这里的相关有两种形式：数据相关和控制相关。这些相关会导致流水线产生计算错误，这种错误称为冒险，冒险也分为数据冒险和控制冒险。

###### 流水线控制逻辑：

######     期望：

######     1）加载/使用冒险：从一条内存中读出一个值的指令和一条使用该值的指令之间，流水线必须暂停一个周期；

######     2）处理ret：流水线必须暂停知道ret指令到达写回阶段；

######     3）预测错误的分支：在分支逻辑发现不应该选择分支之前，分支目标处的几条指令已经进入刘世贤了。必须取消这些指令。并从跳转指令后面的那条指令开始取指。

######     4）异常：当一条指令导致异常，就要进制后面的指令更新程序员可见的状态，并且在异常指令到达写回阶段时，停止执行。

###### 

##### 出现控制冒险的处理流程：

###### 1.特殊控制情况所期望的处理

###### 2.发现特殊控制条件（每个控制逻辑都有其出发条件）

###### 3.流水线控制机制

###### 4.控制条件的组合

###### 5.控制逻辑的实现











###### 

###### 

   

















